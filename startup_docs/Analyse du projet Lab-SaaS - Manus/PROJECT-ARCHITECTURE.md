Text file: PROJECT-ARCHITECTURE.md
Latest content with line numbers:
2	
3	> **ğŸ“¢ IMPORTANT** : Pour les features futures (aprÃ¨s Step 17), consultez [ROADMAP.md](../../ROADMAP.md)  
4	> Ce fichier contient l'historique Steps 0-35 (complÃ©tÃ©s) et l'architecture globale.
5	
6	**Version:** 2.15.0 - Enterprise RBAC Scale  
7	**DerniÃ¨re mise Ã  jour:** 2025-10-19
8	
9	---
10	
11	## ğŸš€ NOUVEAUTÃ‰S v2.15.0 - Enterprise Scale Architecture
12	
13	### Multi-Level Caching Architecture
14	
15	```
16	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
17	â”‚                    PERMISSION CHECK REQUEST                  â”‚
18	â”‚                  (user_id: UUID, resource: str)              â”‚
19	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
20	                               â”‚
21	                               â–¼
22	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
23	â”‚                   L1: IN-MEMORY CACHE                         â”‚
24	â”‚                   (cachetools TTLCache)                       â”‚
25	â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
26	â”‚  â”‚ Max Size: 10,000 entries                                â”‚  â”‚
27	â”‚  â”‚ TTL: 60 seconds                                         â”‚  â”‚
28	â”‚  â”‚ Eviction: LRU                                           â”‚  â”‚
29	â”‚  â”‚ Hit Rate: 60%                                           â”‚  â”‚
30	â”‚  â”‚ Latency: < 1ms                                         â”‚  â”‚
31	â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
32	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
33	                   â”‚ HIT âœ…                â”‚ MISS âŒ
34	                   â”‚                       â–¼
35	                   â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
36	                   â”‚           â”‚    L2: REDIS CACHE              â”‚
37	                   â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
38	                   â”‚           â”‚  â”‚ TTL: 15 minutes          â”‚   â”‚
39	                   â”‚           â”‚  â”‚ Hit Rate: 35% (of L1 missâ”‚   â”‚
40	                   â”‚           â”‚  â”‚ Latency: < 10ms          â”‚   â”‚
41	                   â”‚           â”‚  â”‚ Stampede Prevention: âœ…  â”‚   â”‚
42	                   â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
43	                   â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
44	                   â”‚                  â”‚ HIT âœ…       â”‚ MISS âŒ
45	                   â”‚                  â”‚              â–¼
46	                   â”‚                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
47	                   â”‚                  â”‚    â”‚  L3: DATABASE QUERY   â”‚
48	                   â”‚                  â”‚    â”‚  (Materialized View)  â”‚
49	                   â”‚                  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
50	                   â”‚                  â”‚    â”‚  â”‚ Query: 10ms    â”‚   â”‚
51	                   â”‚                  â”‚    â”‚  â”‚ Hit Rate: 5%   â”‚   â”‚
52	                   â”‚                  â”‚    â”‚  â”‚ Refresh: 15min â”‚   â”‚
53	                   â”‚                  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
54	                   â”‚                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
55	                   â”‚                  â”‚              â”‚
56	                   â”‚                  â”‚              â–¼
57	                   â”‚                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
58	                   â”‚                  â”‚    â”‚  POPULATE CACHES      â”‚
59	                   â”‚                  â”‚    â”‚  L2 â† Data            â”‚
60	                   â”‚                  â”‚    â”‚  L1 â† Data            â”‚
61	                   â”‚                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
62	                   â”‚                  â”‚              â”‚
63	                   â–¼                  â–¼              â–¼
64	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
65	â”‚                   RETURN PERMISSIONS                          â”‚
66	â”‚                   Avg Latency: < 5ms                          â”‚
67	â”‚                   Hit Rate: 98%                               â”‚
68	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
69	```
70	
71	### Hierarchical Permissions Architecture
72	
73	```
74	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
75	â”‚                    ORGANIZATION                              â”‚
76	â”‚                    (Mono-tenant)                             â”‚
77	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
78	                      â”‚
79	        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
80	        â”‚                           â”‚
81	        â–¼                           â–¼
82	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
83	â”‚  DEPARTMENT 1    â”‚        â”‚  DEPARTMENT 2    â”‚
84	â”‚  Permissions: 5  â”‚        â”‚  Permissions: 3  â”‚
85	â”‚  Inheritable: âœ… â”‚        â”‚  Inheritable: âœ… â”‚
86	â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
87	         â”‚                           â”‚
88	    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
89	    â–¼         â–¼                 â–¼         â–¼
90	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
91	â”‚SERVICE1â”‚ â”‚SERVICE2â”‚      â”‚SERVICE3â”‚ â”‚SERVICE4â”‚
92	â”‚Perms: 2â”‚ â”‚Perms: 1â”‚      â”‚Perms: 0â”‚ â”‚Perms: 2â”‚
93	â”‚Inherit:â”‚ â”‚Inherit:â”‚      â”‚(inhÃ©riteâ”‚ â”‚Inherit:â”‚
94	â”‚  5â†’7   â”‚ â”‚  5â†’6   â”‚      â”‚   3)    â”‚ â”‚  3â†’5   â”‚
95	â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
96	    â”‚          â”‚               â”‚          â”‚
97	    â–¼          â–¼               â–¼          â–¼
98	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
99	â”‚ TEAM 1 â”‚ â”‚ TEAM 2 â”‚      â”‚ TEAM 3 â”‚ â”‚ TEAM 4 â”‚
100	â”‚Perms: 1â”‚ â”‚Perms: 0â”‚      â”‚Perms: 2â”‚ â”‚Perms: 0â”‚
101	â”‚Total: 8â”‚ â”‚Total: 6â”‚      â”‚Total: 5â”‚ â”‚Total: 5â”‚
102	â”‚(7+1)   â”‚ â”‚(inheritâ”‚      â”‚(3+2)   â”‚ â”‚(inheritâ”‚
103	â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
104	    â”‚          â”‚               â”‚          â”‚
105	    â–¼          â–¼               â–¼          â–¼
106	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
107	â”‚            USERS (Team Members)             â”‚
108	â”‚  Inherit ALL permissions from:              â”‚
109	â”‚  - Department (via Service via Team)        â”‚
110	â”‚  - Service (via Team)                       â”‚
111	â”‚  - Team (direct)                            â”‚
112	â”‚  + Role permissions                         â”‚
113	â”‚  + Custom grants/revokes                    â”‚
114	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
115	```
116	
117	### Permission Check Flow v2.15.0
118	
119	```
120	User requests: GET /devices
121	â”‚
122	â–¼
123	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
124	â”‚  1. Extract user_id from JWT cookie      â”‚
125	â”‚     user_id: 88b2da74-...                â”‚
126	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
127	           â”‚
128	           â–¼
129	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
130	â”‚  2. Check L1 cache (in-memory)           â”‚
131	â”‚     Key: user:88b2da74:permissions       â”‚
132	â”‚     Hit? 60% chance                      â”‚
133	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
134	           â”‚ MISS
135	           â–¼
136	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
137	â”‚  3. Check L2 cache (Redis)               â”‚
138	â”‚     Key: user_permissions:88b2da74       â”‚
139	â”‚     Hit? 35% chance                      â”‚
140	â”‚     + Populate L1                        â”‚
141	â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
142	           â”‚ MISS
143	           â–¼
144	â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
145	â”‚  4. Query Materialized View (DB)         â”‚
146	â”‚     SELECT * FROM                        â”‚
147	â”‚       user_effective_permissions_mv      â”‚
148	â”‚     WHERE user_id = '88b2da74...'        â”‚
149	â”‚                                          â”‚
150	â”‚     Returns:                             â”‚